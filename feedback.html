<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anytime Shift - Beta Feedback</title>

  <style>
    :root{
      --blue:#001f3f;
      --red:#d71920;
      --bg:#f5f7fb;
      --text:#0f172a;
      --muted:#4b5563;
      --card:#ffffff;
      --border:rgba(15,23,42,0.12);
      --shadow:0 14px 30px rgba(0,0,0,0.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 28px 14px;
    }
    .container{max-width: 860px; margin: 0 auto;}
    .card{
      background: var(--card);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 22px;
    }
    header{
      text-align:center;
      margin-bottom: 14px;
    }
    .logo{
      display:flex;
      justify-content:center;
      align-items:center;
      margin-bottom: 8px;
    }
    .logo img{width: 220px; max-width: 70%; height:auto; display:block;}
    .subtitle{color: var(--red); font-weight: 800; font-size: 14px;}
    h1{margin: 10px 0 6px; font-size: 26px;}
    .intro{color: var(--muted); margin: 0 auto 16px; max-width: 60ch; line-height: 1.5;}
    .pill{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 12px;
      margin-top: 10px;
    }
    .section{
      border-top: 1px solid rgba(15,23,42,0.08);
      padding-top: 18px;
      margin-top: 18px;
    }
    .section h2{margin: 0 0 8px; font-size: 18px; color: var(--blue);}
    .help{margin: 0 0 14px; color: var(--muted); font-size: 14px; line-height: 1.45;}
    .q{margin: 14px 0;}
    .q label.title{display:block; font-weight: 800; margin-bottom: 8px;}
    .req{color: var(--red); margin-left: 6px;}
    .choices{display:flex; flex-wrap:wrap; gap: 10px;}
    .choice{
      border: 2px solid var(--border);
      border-radius: 14px;
      padding: 10px 12px;
      background: #fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 8px;
      min-width: 160px;
      transition: border-color .15s ease, transform .08s ease;
    }
    .choice:hover{border-color: rgba(0,31,63,0.35);}
    .choice:active{transform: translateY(1px);}
    .choice input{transform: scale(1.1); accent-color: var(--blue);}
    textarea{
      width: 100%;
      border: 2px solid var(--border);
      border-radius: 14px;
      padding: 12px 12px;
      min-height: 110px;
      font-size: 14px;
      resize: vertical;
    }
    textarea:focus, input:focus{
      outline: none;
      border-color: rgba(0,31,63,0.45);
      box-shadow: 0 0 0 3px rgba(0,31,63,0.10);
    }
    .row{display:grid; grid-template-columns: 1fr 1fr; gap: 12px;}
    @media (max-width: 720px){ .row{grid-template-columns:1fr;} }

    .actions{
      margin-top: 18px;
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items:center;
    }
    button{
      border: 0;
      border-radius: 14px;
      padding: 12px 16px;
      font-weight: 900;
      font-size: 15px;
      cursor:pointer;
    }
    .primary{
      background: var(--blue);
      color:#fff;
      box-shadow: 0 10px 18px rgba(0,31,63,0.16);
    }
    .primary:disabled{
      background: #9aa6c2;
      box-shadow:none;
      cursor:not-allowed;
    }
    .status{color: var(--muted); font-size: 14px;}
    .hide{display:none !important;}

    .success{
      text-align:center;
      padding: 10px 8px;
    }
    .check{
      width: 72px;
      height: 72px;
      border-radius: 999px;
      margin: 14px auto;
      display:grid;
      place-items:center;
      font-size: 34px;
      font-weight: 900;
      color: var(--red);
      border: 3px solid rgba(215,25,32,0.35);
      background: rgba(215,25,32,0.06);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card" id="formView">
      <header>
        <div class="logo">
          <img src="/anytimeshift-logo.png" alt="Anytime Shift" />
        </div>
        <div class="subtitle">Beta Feedback</div>
        <h1>Help us improve</h1>
        <p class="intro">
          This takes 2–4 minutes. Answer what you tried — it’s totally okay to skip things you didn’t use.
        </p>
        <div class="pill" id="contextPill">Loading your form…</div>
      </header>

      <form id="feedbackForm">
        <input type="hidden" name="token" id="token" />
        <input type="hidden" name="role" id="role" />

        <!-- COMMON -->
        <div class="section">
          <h2>Getting started</h2>
          <p class="help">These help us understand account setup and basic usage.</p>

          <div class="q">
            <label class="title">1) Was it easy to register and log in?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="loginEase" value="Very easy"> Very easy</label>
              <label class="choice"><input required type="radio" name="loginEase" value="Easy"> Easy</label>
              <label class="choice"><input required type="radio" name="loginEase" value="Okay"> Okay</label>
              <label class="choice"><input required type="radio" name="loginEase" value="Difficult"> Difficult</label>
              <label class="choice"><input required type="radio" name="loginEase" value="Very difficult"> Very difficult</label>
            </div>
          </div>

          <div class="q">
            <label class="title">2) Which login method did you use?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="loginMethod" value="Email & password"> Email & password</label>
              <label class="choice"><input required type="radio" name="loginMethod" value="Google sign-in"> Google sign-in</label>
            </div>
          </div>

          <div class="q">
            <label class="title">3) Did you face any problems while signing up or logging in?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="loginIssues" value="No"> No</label>
              <label class="choice"><input required type="radio" name="loginIssues" value="Yes (minor issues)"> Yes (minor issues)</label>
              <label class="choice"><input required type="radio" name="loginIssues" value="Yes (major issues)"> Yes (major issues)</label>
            </div>
          </div>

          <div class="q">
            <label class="title">4) If you faced issues, what went wrong?</label>
            <textarea name="loginIssueDetails" placeholder="Example: OTP didn’t arrive, error message, stuck on loading…"></textarea>
          </div>
        </div>

        <!-- NAVIGATION -->
        <div class="section">
          <h2>Navigating the app</h2>
          <p class="help">We want to know if anything felt repetitive, confusing, or too many steps.</p>

          <div class="q">
            <label class="title">5) Was it easy to understand where to go first after logging in?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="firstStepClarity" value="Yes"> Yes</label>
              <label class="choice"><input required type="radio" name="firstStepClarity" value="Somewhat"> Somewhat</label>
              <label class="choice"><input required type="radio" name="firstStepClarity" value="No"> No</label>
            </div>
          </div>

          <div class="q">
            <label class="title">6) Did you feel any steps were unnecessary, repeated, or confusing?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="repetitiveSteps" value="No"> No</label>
              <label class="choice"><input required type="radio" name="repetitiveSteps" value="Yes"> Yes</label>
            </div>
          </div>

          <div class="q">
            <label class="title">7) If yes, which steps felt unnecessary or repeated?</label>
            <textarea name="repetitiveStepsDetails" placeholder="Tell us which screen/step and what felt repeated."></textarea>
          </div>

          <div class="q">
            <label class="title">8) Overall, how easy was it to move between screens?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="navigationEase" value="Very easy"> Very easy</label>
              <label class="choice"><input required type="radio" name="navigationEase" value="Easy"> Easy</label>
              <label class="choice"><input required type="radio" name="navigationEase" value="Okay"> Okay</label>
              <label class="choice"><input required type="radio" name="navigationEase" value="Difficult"> Difficult</label>
              <label class="choice"><input required type="radio" name="navigationEase" value="Very difficult"> Very difficult</label>
            </div>
          </div>
        </div>

        <!-- EMPLOYEE QUESTIONS -->
        <div class="section hide" id="employeeSection">
          <h2>Instant jobs (Shift Seeker)</h2>
          <p class="help">Questions about finding and accepting instant work.</p>

          <div class="q">
            <label class="title">9) Was it easy to find instant jobs near your location?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="emp_findJobs" value="Very easy" required> Very easy</label>
              <label class="choice"><input type="radio" name="emp_findJobs" value="Easy" required> Easy</label>
              <label class="choice"><input type="radio" name="emp_findJobs" value="Okay" required> Okay</label>
              <label class="choice"><input type="radio" name="emp_findJobs" value="Difficult" required> Difficult</label>
              <label class="choice"><input type="radio" name="emp_findJobs" value="Very difficult" required> Very difficult</label>
            </div>
          </div>

          <div class="q">
            <label class="title">10) Did you clearly understand these were instant jobs (start soon / immediate)?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="emp_instantClarity" value="Yes" required> Yes</label>
              <label class="choice"><input type="radio" name="emp_instantClarity" value="Somewhat" required> Somewhat</label>
              <label class="choice"><input type="radio" name="emp_instantClarity" value="No" required> No</label>
            </div>
          </div>

          <div class="q">
            <label class="title">11) Were job details (location, time, pay) clear before accepting?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="emp_jobDetailsClarity" value="Very clear" required> Very clear</label>
              <label class="choice"><input type="radio" name="emp_jobDetailsClarity" value="Somewhat clear" required> Somewhat clear</label>
              <label class="choice"><input type="radio" name="emp_jobDetailsClarity" value="Not clear" required> Not clear</label>
            </div>
          </div>

          <div class="q">
            <label class="title">12) Was it easy to accept or reject an instant job?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="emp_acceptEase" value="Very easy" required> Very easy</label>
              <label class="choice"><input type="radio" name="emp_acceptEase" value="Easy" required> Easy</label>
              <label class="choice"><input type="radio" name="emp_acceptEase" value="Okay" required> Okay</label>
              <label class="choice"><input type="radio" name="emp_acceptEase" value="Difficult" required> Difficult</label>
              <label class="choice"><input type="radio" name="emp_acceptEase" value="Very difficult" required> Very difficult</label>
            </div>
          </div>

          <div class="q">
            <label class="title">13) Did you clearly understand when the job started and ended?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="emp_startEndClarity" value="Yes" required> Yes</label>
              <label class="choice"><input type="radio" name="emp_startEndClarity" value="Somewhat" required> Somewhat</label>
              <label class="choice"><input type="radio" name="emp_startEndClarity" value="No" required> No</label>
            </div>
          </div>

          <div class="q">
            <label class="title">14) Did anything feel confusing during the instant job flow? (arrival, start, end)</label>
            <textarea name="emp_jobFlowIssues" placeholder="Tell us what happened and where you got confused."></textarea>
          </div>
        </div>

        <!-- EMPLOYER QUESTIONS -->
        <div class="section hide" id="employerSection">
          <h2>Instant jobs (Business)</h2>
          <p class="help">Questions about posting and managing instant hiring.</p>

          <div class="q">
            <label class="title">9) Was it easy to create an instant job?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="biz_createJob" value="Very easy" required> Very easy</label>
              <label class="choice"><input type="radio" name="biz_createJob" value="Easy" required> Easy</label>
              <label class="choice"><input type="radio" name="biz_createJob" value="Okay" required> Okay</label>
              <label class="choice"><input type="radio" name="biz_createJob" value="Difficult" required> Difficult</label>
              <label class="choice"><input type="radio" name="biz_createJob" value="Very difficult" required> Very difficult</label>
            </div>
          </div>

          <div class="q">
            <label class="title">10) Were you able to clearly enter job details (location, time, pay, role)?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="biz_jobDetails" value="Yes" required> Yes</label>
              <label class="choice"><input type="radio" name="biz_jobDetails" value="Somewhat" required> Somewhat</label>
              <label class="choice"><input type="radio" name="biz_jobDetails" value="No" required> No</label>
            </div>
          </div>

          <div class="q">
            <label class="title">11) Was it easy to see who accepted or rejected your job?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="biz_candidateVisibility" value="Very easy" required> Very easy</label>
              <label class="choice"><input type="radio" name="biz_candidateVisibility" value="Easy" required> Easy</label>
              <label class="choice"><input type="radio" name="biz_candidateVisibility" value="Okay" required> Okay</label>
              <label class="choice"><input type="radio" name="biz_candidateVisibility" value="Difficult" required> Difficult</label>
              <label class="choice"><input type="radio" name="biz_candidateVisibility" value="Very difficult" required> Very difficult</label>
            </div>
          </div>

          <div class="q">
            <label class="title">12) Did you clearly understand when the worker arrived and started the job?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input type="radio" name="biz_arrivalClarity" value="Yes" required> Yes</label>
              <label class="choice"><input type="radio" name="biz_arrivalClarity" value="Somewhat" required> Somewhat</label>
              <label class="choice"><input type="radio" name="biz_arrivalClarity" value="No" required> No</label>
            </div>
          </div>

          <div class="q">
            <label class="title">13) What information felt missing or unclear while posting or managing the instant job?</label>
            <textarea name="biz_missingInfo" placeholder="Example: pay field, location, role selection, confirmation…"></textarea>
          </div>
        </div>

        <!-- STRIPE -->
        <div class="section">
          <h2>Stripe setup & payments</h2>
          <p class="help">This is critical for instant jobs to work smoothly.</p>

          <div class="row">
            <div class="q">
              <label class="title">15) Were you asked to set up a Stripe account?<span class="req">*</span></label>
              <div class="choices">
                <label class="choice"><input required type="radio" name="stripeAsked" value="Yes"> Yes</label>
                <label class="choice"><input required type="radio" name="stripeAsked" value="No"> No</label>
              </div>
            </div>

            <div class="q">
              <label class="title">16) How easy was Stripe setup?<span class="req">*</span></label>
              <div class="choices">
                <label class="choice"><input required type="radio" name="stripeEase" value="Very easy"> Very easy</label>
                <label class="choice"><input required type="radio" name="stripeEase" value="Easy"> Easy</label>
                <label class="choice"><input required type="radio" name="stripeEase" value="Okay"> Okay</label>
                <label class="choice"><input required type="radio" name="stripeEase" value="Difficult"> Difficult</label>
                <label class="choice"><input required type="radio" name="stripeEase" value="Very difficult"> Very difficult</label>
              </div>
            </div>
          </div>

          <div class="q">
            <label class="title">17) Did you understand why Stripe setup was needed?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="stripeWhyClear" value="Yes"> Yes</label>
              <label class="choice"><input required type="radio" name="stripeWhyClear" value="Somewhat"> Somewhat</label>
              <label class="choice"><input required type="radio" name="stripeWhyClear" value="No"> No</label>
            </div>
          </div>

          <div class="q">
            <label class="title">18) Did you face any issues during Stripe setup or payments?</label>
            <textarea name="stripeIssues" placeholder="Example: verification, bank link, errors, stuck on loading…"></textarea>
          </div>

          <div class="q">
            <label class="title">19) Was it clear when and how payment works after the job is done?<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="paymentClarity" value="Very clear"> Very clear</label>
              <label class="choice"><input required type="radio" name="paymentClarity" value="Somewhat clear"> Somewhat clear</label>
              <label class="choice"><input required type="radio" name="paymentClarity" value="Not clear"> Not clear</label>
            </div>
          </div>
        </div>

        <!-- OVERALL -->
        <div class="section">
          <h2>Overall</h2>
          <p class="help">Final thoughts so we can prioritize fixes.</p>

          <div class="q">
            <label class="title">20) Overall rating<span class="req">*</span></label>
            <div class="choices">
              <label class="choice"><input required type="radio" name="overallRating" value="1"> ⭐ 1</label>
              <label class="choice"><input required type="radio" name="overallRating" value="2"> ⭐ 2</label>
              <label class="choice"><input required type="radio" name="overallRating" value="3"> ⭐ 3</label>
              <label class="choice"><input required type="radio" name="overallRating" value="4"> ⭐ 4</label>
              <label class="choice"><input required type="radio" name="overallRating" value="5"> ⭐ 5</label>
            </div>
          </div>

          <div class="q">
            <label class="title">21) What worked really well?</label>
            <textarea name="workedWell" placeholder="Tell us what you liked most."></textarea>
          </div>

          <div class="q">
            <label class="title">22) What was the most frustrating or confusing part?</label>
            <textarea name="mostFrustrating" placeholder="Tell us what to fix first."></textarea>
          </div>

          <div class="q">
            <label class="title">23) What ONE change would make this app much better for you?</label>
            <textarea name="oneImprovement" placeholder="One improvement that would make a big difference."></textarea>
          </div>
        </div>

        <div class="actions">
          <button class="primary" id="submitBtn" type="submit">Submit feedback</button>
          <div class="status" id="status"></div>
        </div>
      </form>
    </div>

    <div class="card hide" id="successView">
      <div class="success">
        <div class="logo">
          <img src="/anytimeshift-logo.png" alt="Anytime Shift" />
        </div>
        <div class="subtitle">Beta Feedback</div>
        <div class="check">✓</div>
        <h2>Thank you!</h2>
        <p class="intro">Your feedback was submitted successfully.</p>
      </div>
    </div>
  </div>

  <script>
    const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbxc5XmLcS3WgN8_jojcZFPz2HPqcKHYo4zEtDURqiQQ2Gb7IklEZ4m8yReqbBGrFGEb/exec";

    const qs = new URLSearchParams(location.search);
    const token = qs.get('token') || '';
    const roleFromUrl = (qs.get('role') || '').toLowerCase(); // "employee" / "employer" (or business/shift-seeker)

    const tokenEl = document.getElementById('token');
    const roleEl = document.getElementById('role');
    const pillEl = document.getElementById('contextPill');

    const employeeSection = document.getElementById('employeeSection');
    const employerSection = document.getElementById('employerSection');

    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');

    function normalizeRole(r){
      const x = String(r || '').toLowerCase().trim();
      if (!x) return '';
      if (x.includes('employer') || x.includes('business')) return 'employer';
      if (x.includes('employee') || x.includes('shift')) return 'employee';
      return x;
    }

    function showRole(role){
      const normalized = normalizeRole(role);

      employeeSection.classList.add('hide');
      employerSection.classList.add('hide');

      if (normalized === 'employee') {
        employeeSection.classList.remove('hide');
        pillEl.textContent = 'Form: Shift Seeker (Employee)';
      } else if (normalized === 'employer') {
        employerSection.classList.remove('hide');
        pillEl.textContent = 'Form: Business (Employer)';
      } else {
        pillEl.textContent = 'Form: (Role not found — please use the email link)';
      }

      roleEl.value = normalized;
    }

    async function loadContext(){
      tokenEl.value = token;

      // Best case: role passed via email link
      if (roleFromUrl) {
        showRole(roleFromUrl);
        return;
      }

      // Fallback: try Apps Script lookup by token
      try {
        const url = `${GAS_ENDPOINT}?action=getFeedbackContext&token=${encodeURIComponent(token)}`;
        const res = await fetch(url, { method: 'GET' });
        const data = await res.json();
        if (data && data.role) {
          showRole(data.role);
          return;
        }
        showRole('');
      } catch (e) {
        showRole('');
      }
    }

    loadContext();

    document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      statusEl.textContent = 'Submitting…';
      submitBtn.disabled = true;

      const fd = new FormData(e.target);
      const payload = { token: fd.get('token') || '', role: fd.get('role') || '' };

      for (const [k, v] of fd.entries()) {
        if (k === 'token' || k === 'role') continue;
        payload[k] = v;
      }

      try {
        const res = await fetch('/.netlify/functions/submitFeedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data.message || 'Failed to submit');

        document.getElementById('formView').classList.add('hide');
        document.getElementById('successView').classList.remove('hide');
      } catch (err) {
        statusEl.textContent = err.message || 'Something went wrong. Please try again.';
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
